<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebGL Canvas</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
        canvas {
            display: block;
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <canvas id="webgl" width="500" height="1758"></canvas>

    <script id="vertexShader" type="x-shader/x-vertex">
        attribute vec4 a_position;
        
        uniform mat4 u_modelViewMatrix;
        uniform mat4 u_projectionMatrix;
        
        void main() {
            gl_Position = a_position;
        }
    </script>
    <script id="fragmentShader" type="x-shader/x-fragment">
        precision highp float;
        
        uniform vec2 u_resolution;
        uniform vec2 u_mouse;
        uniform float u_time;
        uniform sampler2D u_noise;
        
        vec2 getScreenSpace() {
            vec2 uv = (gl_FragCoord.xy - 0.5 * u_resolution.xy) / min(u_resolution.y, u_resolution.x);
            
            return uv;
        }
        
        void main() {
            vec2 uv = getScreenSpace();
            
            uv *= 30.;
            vec2 grid = floor(uv);
            vec2 subuv = fract(uv);
            
            vec3 colour = vec3(0);
            
            for(int x = -1; x < 2; x++) {
                for(int y = -1; y < 2; y++) {
                    vec2 os = vec2(x,y);
                    vec2 _grid = grid + os;
                    vec2 _subuv = subuv - os;
                    
                    float r = texture2D(u_noise, _grid/(512. + 256.*sin(u_time))).r * 0.5;
                    colour += vec3(smoothstep(r + 0.01, r, length(_subuv - 0.5)));
                }
            }
            
            gl_FragColor = vec4(colour, 1.0);
        }
    </script>

    <script>
        // Your JavaScript for WebGL initialization and rendering goes here
        const canvas = document.getElementById('webgl');
        const gl = canvas.getContext('webgl');

        // Initialize shaders
        const vertexShaderSource = document.getElementById('vertexShader').textContent;
        const fragmentShaderSource = document.getElementById('fragmentShader').textContent;

        const vertexShader = compileShader(gl, vertexShaderSource, gl.VERTEX_SHADER);
        const fragmentShader = compileShader(gl, fragmentShaderSource, gl.FRAGMENT_SHADER);

        // Create shader program
        const program = gl.createProgram();
        gl.attachShader(program, vertexShader);
        gl.attachShader(program, fragmentShader);
        gl.linkProgram(program);
        gl.useProgram(program);

        // Get attribute and uniform locations
        const positionAttributeLocation = gl.getAttribLocation(program, 'a_position');
        gl.enableVertexAttribArray(positionAttributeLocation);

        // Create buffer
        const positionBuffer = gl.createBuffer();
        gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
        gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([
            -1.0,  1.0,
            -1.0, -1.0,
             1.0,  1.0,
             1.0, -1.0,
        ]), gl.STATIC_DRAW);

        // Setup position attribute
        gl.vertexAttribPointer(positionAttributeLocation, 2, gl.FLOAT, false, 0, 0);

        // Set up uniforms
        const resolutionUniformLocation = gl.getUniformLocation(program, 'u_resolution');
        gl.uniform2f(resolutionUniformLocation, canvas.width, canvas.height);

        const timeUniformLocation = gl.getUniformLocation(program, 'u_time');

        // Render loop
        function render() {
            gl.uniform1f(timeUniformLocation, performance.now() / 1000);
            gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);
            requestAnimationFrame(render);
        }

        render();

        // Function to compile shader
        function compileShader(gl, source, type) {
            const shader = gl.createShader(type);
            gl.shaderSource(shader, source);
            gl.compileShader(shader);
            if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
                console.error('Error compiling shader:', gl.getShaderInfoLog(shader));
                gl.deleteShader(shader);
                return null;
            }
            return shader;
        }
    </script>
    <script src="src/javascript/sketch.js"></script>
</body>
</html>
