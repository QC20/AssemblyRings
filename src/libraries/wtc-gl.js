/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/wtc-gl@1.2.0-beta.1/dist/wtc-gl.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{Mat4 as t,Vec3 as e,Quat as i,Vec2 as s,Mat3 as r}from"/npm/wtc-math@1.0.20/+esm";export*from"/npm/wtc-math@1.0.20/+esm";var a=Object.defineProperty,n=(t,e,i)=>(((t,e,i)=>{e in t?a(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i})(t,"symbol"!=typeof e?e+"":e,i),i),h=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},o=(t,e,i)=>(h(t,e,"read from private field"),i?i.call(t):e.get(t)),l=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},d=(t,e,i,s)=>(h(t,e,"write to private field"),s?s.call(t,i):e.set(t,i),i);class u{constructor(){n(this,"parent"),n(this,"children"),n(this,"visible"),n(this,"matrix"),n(this,"worldMatrix"),n(this,"matrixAutoUpdate"),n(this,"worldMatrixNeedsUpdate",!1),n(this,"position"),n(this,"quaternion"),n(this,"scale"),n(this,"rotation"),n(this,"up"),this.parent=null,this.children=[],this.visible=!0,this.matrix=new t,this.worldMatrix=new t,this.matrixAutoUpdate=!0,this.position=new e,this.quaternion=new i,this.scale=new e(1,1,1),this.rotation=new e,this.up=new e(0,1,0)}updateRotation(){this.quaternion=i.fromEuler(this.rotation)||new i}updateQuaternion(){const i=t.fromQuat(this.quaternion);this.rotation=e.fromRotationMatrix(i)||new e}setParent(t,e=!0){this.parent&&t!==this.parent&&this.parent.removeChild(this,!1),this.parent=t,e&&t&&t.addChild(this,!1)}addChild(t,e=!0){~this.children.indexOf(t)||this.children.push(t),e&&t.setParent(this,!1)}removeChild(t,e=!0){~this.children.indexOf(t)&&this.children.splice(this.children.indexOf(t),1),e&&t.setParent(null,!1)}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.worldMatrixNeedsUpdate||t)&&(null===this.parent||void 0===this.parent?this.worldMatrix=this.matrix.clone():this.worldMatrix=this.parent.worldMatrix.multiplyNew(this.matrix),this.worldMatrixNeedsUpdate=!1,t=!0);for(let e=0,i=this.children.length;e<i;e++)this.children[e].updateMatrixWorld(t)}updateMatrix(){this.matrix=t.fromRotationTranslationScale(this.quaternion,this.position,this.scale),this.worldMatrixNeedsUpdate=!0}traverse(t){if(!t(this))for(let e=0,i=this.children.length;e<i;e++)this.children[e].traverse(t)}decompose(){this.position=this.matrix.translation,this.quaternion=this.matrix.rotation,this.scale=this.matrix.scaling;const i=t.fromQuat(this.quaternion);this.rotation=e.fromRotationMatrix(i)||new e}lookAt(i,s=!1){this.matrix=s?t.targetTo(this.position,i,this.up):t.targetTo(i,this.position,this.up),this.quaternion=this.matrix.rotation;const r=t.fromQuat(this.quaternion);this.rotation=e.fromRotationMatrix(r)||new e,this.updateRotation()}}let c=0;class p extends u{constructor(t,{frustumCulled:e=!0,renderOrder:i=0}={}){super(),n(this,"id"),n(this,"gl"),n(this,"program"),n(this,"frustumCulled"),n(this,"renderOrder",0),n(this,"zDepth",0),t.canvas||console.error("WTCGLRenderingContext should be passed as the first argument to Object"),this.gl=t,this.id=c++,this.frustumCulled=e,this.renderOrder=i}draw(...t){}}var m;class g{constructor({canvas:t=document.createElement("canvas"),width:e=300,height:i=150,dpr:r=Math.min(window.devicePixelRatio,2),alpha:a=!1,depth:h=!0,stencil:o=!1,antialias:d=!1,premultipliedAlpha:u=!1,preserveDrawingBuffer:c=!1,powerPreference:p="default",autoClear:g=!0,webgl:f=2}={}){n(this,"dpr"),l(this,m,void 0),n(this,"alpha"),n(this,"colour"),n(this,"depth"),n(this,"stencil"),n(this,"premultipliedAlpha"),n(this,"autoClear"),n(this,"isWebgl2"),n(this,"gl"),n(this,"state"),n(this,"extensions"),n(this,"parameters"),n(this,"currentGeometry"),n(this,"vertexAttribDivisor"),n(this,"drawArraysInstanced"),n(this,"drawElementsInstanced"),n(this,"createVertexArray"),n(this,"bindVertexArray"),n(this,"deleteVertexArray"),n(this,"drawBuffers"),n(this,"currentProgram");const w={alpha:a,depth:h,stencil:o,antialias:d,premultipliedAlpha:u,preserveDrawingBuffer:c,powerPreference:p};if(this.dpr=r,this.alpha=a,this.colour=!0,this.depth=h,this.stencil=o,this.premultipliedAlpha=u,this.autoClear=g,2===f&&(this.gl=t.getContext("webgl2",w)),this.isWebgl2=!!this.gl,this.gl||(this.gl=t.getContext("webgl",w)),!this.gl)return console.error("unable to create webgl context"),this;this.gl.renderer=this,this.dimensions=new s(e,i),this.state={blendFunc:{src:this.gl.ONE,dst:this.gl.ZERO},blendEquation:{modeRGB:this.gl.FUNC_ADD,modeAlpha:this.gl.ONE_MINUS_SRC_ALPHA},cullFace:null,frontFace:this.gl.CCW,depthMask:!0,depthFunc:this.gl.LESS,premultiplyAlpha:!1,flipY:!1,unpackAlignment:4,framebuffer:null,viewport:{width:null,height:null,x:0,y:0},textureUnits:[],activeTextureUnit:0,boundBuffer:null,uniformLocations:new Map},this.extensions={},this.isWebgl2?(this.getExtension("EXT_color_buffer_float"),this.getExtension("OES_texture_float_linear"),this.getExtension("OES_standard_derivatives")):(this.getExtension("OES_texture_float"),this.getExtension("OES_texture_float_linear"),this.getExtension("OES_texture_half_float"),this.getExtension("OES_texture_half_float_linear"),this.getExtension("OES_element_index_uint"),this.getExtension("OES_standard_derivatives"),this.getExtension("EXT_sRGB"),this.getExtension("WEBGL_depth_texture"),this.getExtension("WEBGL_draw_buffers")),this.vertexAttribDivisor=this.getExtension("ANGLE_instanced_arrays","vertexAttribDivisor","vertexAttribDivisorANGLE"),this.drawArraysInstanced=this.getExtension("ANGLE_instanced_arrays","drawArraysInstanced","drawArraysInstancedANGLE"),this.drawElementsInstanced=this.getExtension("ANGLE_instanced_arrays","drawElementsInstanced","drawElementsInstancedANGLE"),this.createVertexArray=this.getExtension("OES_vertex_array_object","createVertexArray","createVertexArrayOES"),this.bindVertexArray=this.getExtension("OES_vertex_array_object","bindVertexArray","bindVertexArrayOES"),this.deleteVertexArray=this.getExtension("OES_vertex_array_object","deleteVertexArray","deleteVertexArrayOES"),this.drawBuffers=this.getExtension("WEBGL_draw_buffers","drawBuffers","drawBuffersWEBGL"),this.parameters={maxTextureUnits:this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxAnisotropy:this.getExtension("EXT_texture_filter_anisotropic")?this.gl.getParameter(this.getExtension("EXT_texture_filter_anisotropic").MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}}set dimensions(t){d(this,m,t),this.gl.canvas.width=t.width*this.dpr,this.gl.canvas.height=t.height*this.dpr}get dimensions(){return o(this,m)}setViewport(t,e){this.state.viewport.width===t.width&&this.state.viewport.height===t.height&&this.state.viewport.x===e.x&&this.state.viewport.y===e.y||(this.state.viewport.width=t.width,this.state.viewport.height=t.height,this.state.viewport.x=e.x,this.state.viewport.y=e.y,this.gl.viewport(e.x,e.y,t.width,t.height))}enable(t){!0!==this.state[t]&&(this.gl.enable(t),this.state[t]=!0)}disable(t){!1!==this.state[t]&&(this.gl.disable(t),this.state[t]=!1)}setBlendFunc(t,e,i,s){this.state.blendFunc.src===t&&this.state.blendFunc.dst===e&&this.state.blendFunc.srcAlpha===i&&this.state.blendFunc.dstAlpha===s||(this.state.blendFunc.src=t,this.state.blendFunc.dst=e,this.state.blendFunc.srcAlpha=i,this.state.blendFunc.dstAlpha=s,void 0!==i&&void 0!==s?this.gl.blendFuncSeparate(t,e,i,s):this.gl.blendFunc(t,e))}setBlendEquation(t,e){t=t||this.gl.FUNC_ADD,(this.state.blendEquation.modeRGB!==t||this.state.blendEquation.modeAlpha!==e)&&(this.state.blendEquation.modeRGB=t,this.state.blendEquation.modeAlpha=e,void 0!==e?this.gl.blendEquationSeparate(t,e):this.gl.blendEquation(t))}set cullFace(t){this.state.cullFace!==t&&(this.state.cullFace=t,this.gl.cullFace(t))}get cullFace(){return this.state.cullFace}set frontFace(t){this.state.frontFace!==t&&(this.state.frontFace=t,this.gl.frontFace(t))}get frontFace(){return this.state.frontFace}set depthMask(t){this.state.depthMask!==t&&(this.state.depthMask=t,this.gl.depthMask(t))}get depthMask(){return this.state.depthMask}set depthFunc(t){this.state.depthFunc!==t&&(this.state.depthFunc=t,this.gl.depthFunc(t))}get depthFunc(){return this.state.depthFunc}set activeTexture(t){this.state.activeTextureUnit!==t&&(this.state.activeTextureUnit=t,this.gl.activeTexture(this.gl.TEXTURE0+t))}get activeTexture(){return this.state.activeTextureUnit}bindFramebuffer({target:t=this.gl.FRAMEBUFFER,buffer:e=null}={}){this.state.framebuffer!==e&&(this.state.framebuffer=e,this.gl.bindFramebuffer(t,e))}getExtension(t,e,i){const s=e;if(e&&this.gl[s]){const t=this.gl[s];return"function"==typeof t?t.bind(this.gl):t}const r=t;if(this.extensions[r]||(this.extensions[r]=this.gl.getExtension(t)),!e)return this.extensions[r];if(!this.extensions[r])return null;if(i){const t=this.extensions[r],e=null==t?void 0:t[i];if(e)return e.bind(t)}}sortOpaque(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program.id!==e.program.id?t.program.id-e.program.id:t.zDepth!==e.zDepth?t.zDepth-e.zDepth:e.id-t.id}sortTransparent(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.zDepth!==e.zDepth?e.zDepth-t.zDepth:e.id-t.id}sortUI(t,e){return t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.program.id!==e.program.id?t.program.id-e.program.id:e.id-t.id}getRenderList({scene:t,camera:e,frustumCull:i,sort:s}){let r=[];if(e&&i&&e.updateFrustum(),t.traverse((t=>!t.visible||(!(t instanceof p)||i&&t.frustumCulled&&e&&!e.frustumIntersects(t)||r.push(t),null))),s){const t=[],i=[],s=[];r.forEach((r=>{const{program:a}=r;if(a?a.transparent?a.depthTest&&i.push(r):t.push(r):s.push(r),0!==r.renderOrder||!a.depthTest||!e)return;const n=r.worldMatrix.translation;n.transformByMat4(e.projectionViewMatrix),r.zDepth=n.z})),t.sort(this.sortOpaque),i.sort(this.sortTransparent),s.sort(this.sortUI),r=t.concat(i,s)}return r}render({scene:t,camera:e,target:i=null,update:r=!0,sort:a=!0,frustumCull:n=!0,clear:h,viewport:o}){null===i?(this.bindFramebuffer(),o||(o=[this.dimensions.scaleNew(this.dpr),new s]),this.setViewport(...o)):(this.bindFramebuffer(i),o||(o=[new s(i.width,i.height),new s]),this.setViewport(...o)),(h||this.autoClear&&!1!==h)&&(this.depth&&(!i||i.depth)&&(this.enable(this.gl.DEPTH_TEST),this.depthMask=!0),this.gl.clear((this.colour?this.gl.COLOR_BUFFER_BIT:0)|(this.depth?this.gl.DEPTH_BUFFER_BIT:0)|(this.stencil?this.gl.STENCIL_BUFFER_BIT:0))),r&&t.updateMatrixWorld(),e&&e.updateMatrixWorld(),this.getRenderList({scene:t,camera:e,frustumCull:n,sort:a}).forEach((t=>{t.draw({camera:e})}))}}m=new WeakMap;const f=new Uint8Array(4);function w(t){return 0==(t&t-1)}let b=1;class E{constructor(t,{image:e,data:i,target:s=t.TEXTURE_2D,type:r=t.UNSIGNED_BYTE,format:a=t.RGBA,internalFormat:h=a,wrapS:o=t.CLAMP_TO_EDGE,wrapT:l=t.CLAMP_TO_EDGE,generateMipmaps:d=!0,minFilter:u=(d?t.NEAREST_MIPMAP_LINEAR:t.LINEAR),magFilter:c=t.LINEAR,premultiplyAlpha:p=!1,unpackAlignment:m=4,flipY:g=s==t.TEXTURE_2D,anisotropy:f=0,level:w=0,width:E,height:A=E}={}){n(this,"id"),n(this,"gl"),n(this,"image"),n(this,"data"),n(this,"texture"),n(this,"width"),n(this,"height"),n(this,"target"),n(this,"type"),n(this,"format"),n(this,"internalFormat"),n(this,"minFilter"),n(this,"magFilter"),n(this,"wrapS"),n(this,"wrapT"),n(this,"generateMipmaps"),n(this,"premultiplyAlpha"),n(this,"flipY"),n(this,"unpackAlignment"),n(this,"anisotropy"),n(this,"level"),n(this,"store"),n(this,"glState"),n(this,"state"),n(this,"needsUpdate"),this.gl=t,this.id=b++,e&&(this.image=e),i&&(this.data=i),this.target=s,this.type=r,this.format=a,this.internalFormat=h,this.minFilter=u,this.magFilter=c,this.wrapS=o,this.wrapT=l,this.generateMipmaps=d,this.premultiplyAlpha=p,this.unpackAlignment=m,this.flipY=g,this.anisotropy=Math.min(f,this.gl.renderer.parameters.maxAnisotropy),this.level=w,E&&(this.width=E),A&&(this.height=A),this.texture=this.gl.createTexture(),this.store={image:void 0},this.state={minFilter:this.gl.NEAREST_MIPMAP_LINEAR,magFilter:this.gl.LINEAR,wrapS:this.gl.REPEAT,wrapT:this.gl.REPEAT,anisotropy:0},this.needsUpdate=!0}bind(){this.gl.renderer.state.textureUnits[this.gl.renderer.state.activeTextureUnit]!==this.id&&(this.gl.bindTexture(this.target,this.texture),this.gl.renderer.state.textureUnits[this.gl.renderer.state.activeTextureUnit]=this.id)}update(t=0){const e=!(this.image===this.store.image&&!this.needsUpdate);if((e||this.gl.renderer.state.textureUnits[t]!==this.id)&&(this.gl.renderer.activeTexture=t,this.bind()),e){if(this.needsUpdate=!1,this.flipY!==this.gl.renderer.state.flipY&&(this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,this.flipY),this.gl.renderer.state.flipY=this.flipY),this.premultiplyAlpha!==this.gl.renderer.state.premultiplyAlpha&&(this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),this.gl.renderer.state.premultiplyAlpha=this.premultiplyAlpha),this.unpackAlignment!==this.gl.renderer.state.unpackAlignment&&(this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,this.unpackAlignment),this.gl.renderer.state.unpackAlignment=this.unpackAlignment),this.minFilter!==this.state.minFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MIN_FILTER,this.minFilter),this.state.minFilter=this.minFilter),this.magFilter!==this.state.magFilter&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_MAG_FILTER,this.magFilter),this.state.magFilter=this.magFilter),this.wrapS!==this.state.wrapS&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_S,this.wrapS),this.state.wrapS=this.wrapS),this.wrapT!==this.state.wrapT&&(this.gl.texParameteri(this.target,this.gl.TEXTURE_WRAP_T,this.wrapT),this.state.wrapT=this.wrapT),this.anisotropy&&this.anisotropy!==this.state.anisotropy&&(this.gl.texParameterf(this.target,this.gl.renderer.getExtension("EXT_texture_filter_anisotropic").TEXTURE_MAX_ANISOTROPY_EXT,this.anisotropy),this.state.anisotropy=this.anisotropy),this.image||this.data){if(this.image instanceof HTMLVideoElement?(this.width=this.image.videoWidth,this.height=this.image.videoHeight):this.image&&"width"in this.image&&(this.width=this.image.width,this.height=this.image.height),this.target===this.gl.TEXTURE_CUBE_MAP&&Array.isArray(this.image))for(let t=0;t<6;t++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+t,this.level,this.internalFormat,this.format,this.type,this.image[t]);else ArrayBuffer.isView(this.data)?this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,this.data):Array.isArray(this.image)||this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,this.image);this.generateMipmaps&&(this.gl.renderer.isWebgl2||!this.image||Array.isArray(this.image)||w(this.image.width)&&w(this.image.height)?this.gl.generateMipmap(this.target):(this.generateMipmaps=!1,this.wrapS=this.wrapT=this.gl.CLAMP_TO_EDGE,this.minFilter=this.gl.LINEAR))}else if(this.target===this.gl.TEXTURE_CUBE_MAP)for(let t=0;t<6;t++)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,f);else this.width?this.gl.texImage2D(this.target,this.level,this.internalFormat,this.width,this.height,0,this.format,this.type,null):this.gl.texImage2D(this.target,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,f);this.store.image=this.image}}}class A{constructor({name:t="uniform",value:e=[1,1],kind:i="float_vec2"}={}){n(this,"name"),n(this,"value"),n(this,"kind"),this.name=t,this.value=e,this.kind=i}setUniform(t,e,i,s=this.value){const r=t.renderer.state.uniformLocations.get(i);if(s instanceof Array){if(void 0===r||r instanceof Array&&r.length!==s.length)t.renderer.state.uniformLocations.set(i,s.slice(0));else if(r instanceof Array){if(function(t,e){if(t.length!==e.length)return!1;for(let i=0,s=t.length;i<s;i++)if(t[i]!==e[i])return!1;return!0}(r,s))return;(function(t,e){for(let i=0,s=t.length;i<s;i++)t[i]=e[i]})(r,s),t.renderer.state.uniformLocations.set(i,r)}}else{if(r===s)return;t.renderer.state.uniformLocations.set(i,s)}const a=s;switch(e){case 5126:return a instanceof Array?t.uniform1fv(i,a):void("number"==typeof a&&t.uniform1f(i,a));case 35664:return t.uniform2fv(i,a);case 35665:return t.uniform3fv(i,a);case 35666:return t.uniform4fv(i,a);case 35670:case 5124:case 35678:case 35680:return null!=a&&a.length?t.uniform1iv(i,a):t.uniform1i(i,a);case 35671:case 35667:return t.uniform2iv(i,a);case 35672:case 35668:return t.uniform3iv(i,a);case 35673:case 35669:return t.uniform4iv(i,a);case 35674:return t.uniformMatrix2fv(i,!1,a);case 35675:return t.uniformMatrix3fv(i,!1,a);case 35676:return null===a?void 0:t.uniformMatrix4fv(i,!1,a)}}bind(t,e,i){if(void 0!==this.value){if("texture"===this.kind&&this.value instanceof E){const s=++t.textureUnit;return this.value.update(s),this.setUniform(t.gl,i.type,e,s)}if("texture_array"===this.kind&&this.value instanceof Array&&this.value[0]instanceof E){const s=[];return this.value.forEach((e=>{const i=++t.textureUnit;e instanceof E&&e.update(i),s.push(i)})),this.setUniform(t.gl,i.type,e,s)}this.setUniform(t.gl,i.type,e)}else console.warn(`${this.name} uniform is missing a value`)}}class x extends p{constructor(e,{geometry:i,program:s,mode:a=e.TRIANGLES,frustumCulled:h=!0,renderOrder:o=0}){super(e,{frustumCulled:h,renderOrder:o}),n(this,"geometry"),n(this,"mode"),n(this,"modelViewMatrix"),n(this,"normalMatrix"),n(this,"beforeRenderCallbacks"),n(this,"afterRenderCallbacks"),e.canvas||console.error("gl not passed as first argument to Mesh"),this.geometry=i,this.program=s,this.mode=a,this.modelViewMatrix=new t,this.normalMatrix=new r,this.beforeRenderCallbacks=[],this.afterRenderCallbacks=[]}addBeforeRender(t){return this.beforeRenderCallbacks.push(t),this}removeBeforeRender(t){this.beforeRenderCallbacks.forEach(((e,i)=>{e==t&&this.beforeRenderCallbacks.splice(i,1)}))}removeAllBeforeRender(){this.beforeRenderCallbacks=[]}addAfterRender(t){return this.afterRenderCallbacks.push(t),this}removeAfterRender(t){this.afterRenderCallbacks.forEach(((e,i)=>{e==t&&this.afterRenderCallbacks.splice(i,1)}))}removeAllAfterRender(){this.afterRenderCallbacks=[]}draw({camera:t}){this.beforeRenderCallbacks.forEach((e=>e&&e({mesh:this,camera:t}))),t?(this.program.uniforms.modelMatrix||Object.assign(this.program.uniforms,{u_modelMatrix:new A({name:"modelMatrix",value:void 0,kind:"mat4"}),u_viewMatrix:new A({name:"viewMatrix",value:void 0,kind:"mat4"}),u_modelViewMatrix:new A({name:"modelViewMatrix",value:void 0,kind:"mat4"}),u_normalMatrix:new A({name:"normalMatrix",value:void 0,kind:"mat3"}),u_projectionMatrix:new A({name:"projectionMatrix",value:void 0,kind:"mat4"}),u_cameraPosition:new A({name:"cameraPosition",value:void 0,kind:"float_vec3"}),u_objectPosition:new A({name:"objectPosition",value:void 0,kind:"float_vec3"})}),this.program.uniforms.u_projectionMatrix.value=t.projectionMatrix.array,this.program.uniforms.u_cameraPosition.value=t.worldPosition.array,this.program.uniforms.u_objectPosition.value=this.position.array,this.program.uniforms.u_viewMatrix.value=t.viewMatrix.array,this.modelViewMatrix=t.viewMatrix.multiplyNew(this.worldMatrix),this.normalMatrix=r.fromMat4(this.modelViewMatrix),this.program.uniforms.u_modelMatrix.value=this.worldMatrix.array,this.program.uniforms.u_modelViewMatrix.value=this.modelViewMatrix.array,this.program.uniforms.u_normalMatrix.value=this.normalMatrix.array):(this.program.uniforms.modelMatrix||Object.assign(this.program.uniforms,{u_objectPosition:new A({name:"objectPosition",value:void 0,kind:"float_vec3"})}),this.program.uniforms.u_objectPosition.value=this.position.array);const e=!!(this.program.cullFace&&this.worldMatrix.determinant<0);this.program.use({flipFaces:e}),this.geometry.draw({mode:this.mode,program:this.program}),this.afterRenderCallbacks.forEach((e=>e&&e({mesh:this,camera:t})))}}let v=1;class T{constructor(t,{vertex:e,fragment:i,uniforms:s={},transparent:r=!1,cullFace:a=t.BACK,frontFace:h=t.CCW,depthTest:o=!0,depthWrite:l=!0,depthFunc:d=t.LESS,transformFeedbackVaryings:u}){var c,p,m,g;n(this,"id"),n(this,"gl"),n(this,"uniforms"),n(this,"transparent"),n(this,"depthTest"),n(this,"depthWrite"),n(this,"cullFace"),n(this,"frontFace"),n(this,"depthFunc"),n(this,"blendFunc"),n(this,"blendEquation"),n(this,"program"),n(this,"uniformLocations"),n(this,"attributeLocations"),n(this,"attributeOrder"),n(this,"textureUnit",-1),t.canvas||console.error("gl not passed as first argument to Program"),this.gl=t,this.uniforms=s,this.id=v++,e||console.warn("vertex shader not supplied"),i||console.warn("fragment shader not supplied"),this.transparent=r,this.cullFace=a,this.frontFace=h,this.depthTest=o,this.depthWrite=l,this.depthFunc=d,this.transparent&&(null==(c=this.blendFunc)||!c.src)&&(null!=(m=null==(p=this.gl)?void 0:p.renderer)&&m.premultipliedAlpha?this.setBlendFunc(this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA):this.setBlendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA));const f=t.createShader(t.VERTEX_SHADER);f&&(t.shaderSource(f,e),t.compileShader(f),""!==t.getShaderInfoLog(f)&&console.warn(`${t.getShaderInfoLog(f)}\nVertex Shader\n${_(e)}`));const w=t.createShader(t.FRAGMENT_SHADER);if(w&&(t.shaderSource(w,i),t.compileShader(w),""!==t.getShaderInfoLog(w)&&console.warn(`${t.getShaderInfoLog(w)}\nFragment Shader\n${_(i)}`)),this.program=t.createProgram(),f&&t.attachShader(this.program,f),w&&t.attachShader(this.program,w),u&&(null==(g=t.transformFeedbackVaryings)||g.call(t,this.program,u,t.SEPARATE_ATTRIBS)),t.linkProgram(this.program),!t.getProgramParameter(this.program,t.LINK_STATUS))return console.warn(t.getProgramInfoLog(this.program)),this;t.deleteShader(f),t.deleteShader(w),this.uniformLocations=new Map;const b=t.getProgramParameter(this.program,t.ACTIVE_UNIFORMS);for(let e=0;e<b;e++){const i=t.getActiveUniform(this.program,e);this.uniformLocations.set(i,t.getUniformLocation(this.program,i.name));const s=i.name.match(/(\w+)/g);null!=s&&s.length&&(i.uniformName=s[0],3===s.length?(i.isStructArray=!0,i.structIndex=Number(s[1]),i.structProperty=s[2]):2===s.length&&isNaN(Number(s[1]))&&(i.isStruct=!0,i.structProperty=s[1]))}this.attributeLocations=new Map;const E=[],A=t.getProgramParameter(this.program,t.ACTIVE_ATTRIBUTES);for(let e=0;e<A;e++){const i=t.getActiveAttrib(this.program,e),s=t.getAttribLocation(this.program,i.name);E[s]=i.name,this.attributeLocations.set(i,s)}this.attributeOrder=E.join("")}setBlendFunc(t,e,i,s){this.blendFunc.src=t,this.blendFunc.dst=e,this.blendFunc.srcAlpha=i,this.blendFunc.dstAlpha=s,t&&(this.transparent=!0)}setBlendEquation(t,e){this.blendEquation.modeRGB=t,this.blendEquation.modeAlpha=e}applyState(){var t,e,i,s,r,a,n,h,o,l;this.depthTest?null==(t=this.gl.renderer)||t.enable(this.gl.DEPTH_TEST):null==(e=this.gl.renderer)||e.disable(this.gl.DEPTH_TEST),this.cullFace?null==(i=this.gl.renderer)||i.enable(this.gl.CULL_FACE):null==(s=this.gl.renderer)||s.disable(this.gl.CULL_FACE),null!=(r=this.blendFunc)&&r.src?null==(a=this.gl.renderer)||a.enable(this.gl.BLEND):null==(n=this.gl.renderer)||n.disable(this.gl.BLEND),this.cullFace&&(this.gl.renderer.cullFace=this.cullFace),this.gl.renderer.frontFace=this.frontFace,this.gl.renderer.depthMask=this.depthWrite,this.gl.renderer.depthFunc=this.depthFunc,null!=(h=this.blendFunc)&&h.src&&this.gl.renderer.setBlendFunc(this.blendFunc.src,this.blendFunc.dst,this.blendFunc.srcAlpha,this.blendFunc.dstAlpha),this.gl.renderer.setBlendEquation(null==(o=this.blendEquation)?void 0:o.modeRGB,null==(l=this.blendEquation)?void 0:l.modeAlpha)}use({flipFaces:t=!1}={}){this.textureUnit=-1,this.gl.renderer.currentProgram===this.id||(this.gl.useProgram(this.program),this.gl.renderer.currentProgram=this.id),this.uniformLocations.forEach(((t,e)=>{const i=e.uniformName;if(!i)return;const s=this.uniforms[i];if(!s)return r=`Active uniform ${i} has not been supplied`,void(M>100||(console.warn(r),M++,M>100&&console.warn("More than 100 program warnings - stopping logs.")));var r;s.bind(this,t,e)})),this.applyState(),t&&(this.gl.renderer.frontFace=this.frontFace===this.gl.CCW?this.gl.CW:this.gl.CCW)}remove(){this.gl.deleteProgram(this.program)}}function _(t){const e=t.split("\n");for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")}let M=0;class y extends u{constructor({near:i=.1,far:s=100,fov:r=45,aspect:a=1,left:h,right:o,top:l,bottom:d,zoom:u=1}){super(),n(this,"near"),n(this,"far"),n(this,"fov"),n(this,"aspect"),n(this,"left"),n(this,"right"),n(this,"top"),n(this,"bottom"),n(this,"zoom"),n(this,"projectionMatrix"),n(this,"viewMatrix"),n(this,"projectionViewMatrix"),n(this,"worldPosition"),n(this,"type"),n(this,"frustum"),this.near=i,this.far=s,this.fov=r,this.aspect=a,this.left=h,this.right=o,this.top=l,this.bottom=d,this.zoom=u,this.projectionMatrix=new t,this.viewMatrix=new t,this.projectionViewMatrix=new t,this.worldPosition=new e,this.type=h||o?"orthographic":"perspective","orthographic"===this.type?this.orthographic():this.perspective()}perspective({near:e=this.near,far:i=this.far,fov:s=this.fov,aspect:r=this.aspect}={}){return Object.assign(this,{near:e,far:i,fov:s,aspect:r}),this.projectionMatrix=t.perspective(s*Math.PI/180,r,e,i),this.type="perspective",this}orthographic({near:e=this.near,far:i=this.far,left:s=this.left,right:r=this.right,bottom:a=this.bottom,top:n=this.top,zoom:h=this.zoom}={}){return Object.assign(this,{near:e,far:i,left:s,right:r,bottom:a,top:n,zoom:h}),s/=h,r/=h,a/=h,n/=h,this.projectionMatrix=t.ortho(s,r,a,n,e,i),this.type="orthographic",this}updateMatrixWorld(){return super.updateMatrixWorld(),this.viewMatrix=this.worldMatrix.invertNew(),this.worldPosition=this.worldMatrix.translation,this.projectionViewMatrix=this.projectionMatrix.multiplyNew(this.viewMatrix),this}lookAt(t){return super.lookAt(t,!0),this}updateFrustum(){this.frustum||(this.frustum={xNeg:{pos:new e,constant:0},xPos:{pos:new e,constant:0},yNeg:{pos:new e,constant:0},yPos:{pos:new e,constant:0},zNeg:{pos:new e,constant:0},zPos:{pos:new e,constant:0}});const t=this.projectionViewMatrix;this.frustum.xNeg.pos=new e(t.a14-t.a11,t.a24-t.a21,t.a34-t.a31),this.frustum.xNeg.constant=t.a44-t.a41,this.frustum.xPos.pos=new e(t.a14+t.a11,t.a24+t.a21,t.a34+t.a31),this.frustum.xPos.constant=t.a44+t.a41,this.frustum.yPos.pos=new e(t.a14+t.a12,t.a24+t.a22,t.a34+t.a32),this.frustum.yPos.constant=t.a44+t.a42,this.frustum.yNeg.pos=new e(t.a14-t.a12,t.a24-t.a22,t.a34-t.a32),this.frustum.yNeg.constant=t.a44-t.a42,this.frustum.zPos.pos=new e(t.a14-t.a13,t.a24-t.a23,t.a34-t.a33),this.frustum.zPos.constant=t.a44-t.a43,this.frustum.zNeg.pos=new e(t.a14+t.a13,t.a24+t.a23,t.a34+t.a33),this.frustum.zNeg.constant=t.a44+t.a43;for(const t in this.frustum){const e=1/this.frustum[t].pos.length;this.frustum[t].pos.scale(e),this.frustum[t].constant*=e}}frustumIntersects(t){if(t instanceof x){if(!t.geometry.attributes.position||((!t.geometry.bounds||t.geometry.bounds.radius===1/0)&&t.geometry.computeBoundingSphere(),!t.geometry.bounds))return!0;const e=t.geometry.bounds.center.clone();e.transformByMat4(t.worldMatrix);const i=t.geometry.bounds.radius*this.maxAxisScale(t.worldMatrix);return this.frustumIntersectsSphere(e,i)}return!1}maxAxisScale(t){const e=t.a11*t.a11+t.a12*t.a12+t.a13*t.a13,i=t.a21*t.a21+t.a22*t.a22+t.a23*t.a23,s=t.a31*t.a31+t.a32*t.a32+t.a33*t.a33;return Math.sqrt(Math.max(e,i,s))}frustumIntersectsSphere(t,e){for(const i in this.frustum){const s=this.frustum[i];if(s.pos.clone().dot(t)+s.constant<-e)return!1}return!0}}const F=class t extends y{constructor({element:i=document.body,enabled:r=!0,target:a=new e(0,0,0),ease:h=.25,inertia:o=.5,enableRotate:l=!0,rotateSpeed:d=.5,autoRotate:u=!1,autoRotateSpeed:c=1,enableZoom:p=!0,zoomSpeed:m=1,zoomStyle:g="dolly",enablePan:f=!0,panSpeed:w=.5,minPolarAngle:b=0,maxPolarAngle:E=Math.PI,minAzimuthAngle:A=-1/0,maxAzimuthAngle:x=1/0,minDistance:v=0,maxDistance:T=1/0}={},_){super(_),n(this,"element"),n(this,"enabled"),n(this,"target"),n(this,"zoomStyle"),n(this,"minDistance"),n(this,"maxDistance"),n(this,"enableRotate"),n(this,"autoRotate"),n(this,"enableZoom"),n(this,"enablePan"),n(this,"ease"),n(this,"inertia"),n(this,"rotateSpeed"),n(this,"autoRotateSpeed"),n(this,"zoomSpeed"),n(this,"panSpeed"),n(this,"minPolarAngle"),n(this,"maxPolarAngle"),n(this,"minAzimuthAngle"),n(this,"maxAzimuthAngle"),n(this,"sphericalDelta"),n(this,"sphericalTarget"),n(this,"spherical"),n(this,"panDelta"),n(this,"offset"),n(this,"rotateStart"),n(this,"panStart"),n(this,"dollyStart"),n(this,"state"),n(this,"mouseButtons"),this.element=i,this.enabled=r,this.target=a,this.zoomStyle=g,this.ease=h||1,this.inertia=o||0,this.enableRotate=l,this.rotateSpeed=d,this.autoRotate=u,this.autoRotateSpeed=c,this.enableZoom=p,this.zoomSpeed=m,this.enablePan=f,this.panSpeed=w,this.minPolarAngle=b,this.maxPolarAngle=E,this.minAzimuthAngle=A,this.maxAzimuthAngle=x,this.minDistance=v,this.maxDistance=T,this.sphericalDelta=new e(1,0,0),this.sphericalTarget=new e(1,0,0),this.spherical=new e(1,0,0),this.panDelta=new e,this.setPosition(this.position.x,this.position.y,this.position.z),this.rotateStart=new s,this.panStart=new s,this.dollyStart=new s,this.state=t.STATE_NONE,this.mouseButtons={ORBIT:0,ZOOM:1,PAN:2},this.onContextMenu=this.onContextMenu.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseWheel=this.onMouseWheel.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.addHandlers()}setPosition(t,e,i){this.position.reset(t,e,i),this.offset=this.position.subtractNew(this.target),this.spherical.radius=this.sphericalTarget.radius=this.offset.length,this.spherical.theta=this.sphericalTarget.theta=Math.atan2(this.offset.x,this.offset.z),this.spherical.phi=this.sphericalTarget.phi=Math.acos(Math.min(Math.max(this.offset.y/this.sphericalTarget.radius,-1),1))}update(){this.autoRotate&&this.handleAutoRotate(),this.sphericalTarget.radius*=this.sphericalDelta.radius,this.sphericalTarget.theta+=this.sphericalDelta.theta,this.sphericalTarget.phi+=this.sphericalDelta.phi,this.sphericalTarget.theta=Math.max(this.minAzimuthAngle,Math.min(this.maxAzimuthAngle,this.sphericalTarget.theta)),this.sphericalTarget.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this.sphericalTarget.phi)),this.sphericalTarget.radius=Math.max(this.minDistance,Math.min(this.maxDistance,this.sphericalTarget.radius)),this.spherical.phi+=(this.sphericalTarget.phi-this.spherical.phi)*this.ease,this.spherical.theta+=(this.sphericalTarget.theta-this.spherical.theta)*this.ease,this.spherical.radius+=(this.sphericalTarget.radius-this.spherical.radius)*this.ease,this.target.add(this.panDelta);const t=this.spherical.radius*Math.sin(Math.max(1e-6,this.spherical.phi));this.offset.x=t*Math.sin(this.spherical.theta),this.offset.y=this.spherical.radius*Math.cos(this.spherical.phi),this.offset.z=t*Math.cos(this.spherical.theta),this.position.resetToVector(this.target.addNew(this.offset)),this.lookAt(this.target),this.sphericalDelta.theta*=this.inertia,this.sphericalDelta.phi*=this.inertia,this.panDelta.scale(this.inertia),this.sphericalDelta.radius=1}forcePosition(){this.offset=this.position.subtractNew(this.target),this.spherical.radius=this.sphericalTarget.radius=this.offset.length,this.spherical.theta=this.sphericalTarget.theta=Math.atan2(this.offset.x,this.offset.z),this.spherical.phi=this.sphericalTarget.phi=Math.acos(Math.min(Math.max(this.offset.y/this.sphericalTarget.radius,-1),1)),this.lookAt(this.target)}getZoomScale(){return Math.pow(.95,this.zoomSpeed)}panLeft(t,i){const s=new e(i[0],i[1],i[2]);s.scale(-t),this.panDelta.add(s)}panUp(t,i){const s=new e(i[4],i[5],i[6]);s.scale(t),this.panDelta.add(s)}pan(t,e){const i=this.element;let s=this.position.subtractNew(this.target).length;s*=Math.tan((this.fov||45)/2*Math.PI/180),this.panLeft(2*t*s/i.clientHeight,this.matrix.array),this.panUp(2*e*s/i.clientHeight,this.matrix.array)}dolly(t){"dolly"===this.zoomStyle?this.sphericalDelta.radius/=t:(this.fov/=t,"orthographic"===this.type?this.orthographic():this.perspective())}handleAutoRotate(){const t=2*Math.PI/60/60*this.autoRotateSpeed;this.sphericalDelta.theta-=t}handleMoveRotate(t,e){const i=new s(t,e),r=i.subtractNew(this.rotateStart).scale(this.rotateSpeed),a=this.element;this.sphericalDelta.theta-=2*Math.PI*r.x/a.clientHeight,this.sphericalDelta.phi-=2*Math.PI*r.y/a.clientHeight,this.rotateStart.resetToVector(i)}handleMouseMoveDolly(t){const e=new s(t.clientX,t.clientY),i=e.subtractNew(this.dollyStart);i.y>0?this.dolly(this.getZoomScale()):i.y<0&&this.dolly(1/this.getZoomScale()),this.dollyStart.resetToVector(e)}handleMovePan(t,e){const i=new s(t,e),r=i.subtractNew(this.panStart).scale(this.panSpeed);this.pan(r.x,r.y),this.panStart.resetToVector(i)}handleTouchStartDollyPan(t){if(this.enableZoom){const e=new s(t.touches[0].pageX-t.touches[1].pageX,t.touches[0].pageY-t.touches[1].pageY).length;this.dollyStart.reset(0,e)}this.enablePan&&this.panStart.reset(.5*(t.touches[0].pageX+t.touches[1].pageX),.5*(t.touches[0].pageY+t.touches[1].pageY))}handleTouchMoveDollyPan(t){if(this.enableZoom){const e=new s(t.touches[0].pageX-t.touches[1].pageX,t.touches[0].pageY-t.touches[1].pageY),i=new s(0,e.length),r=new s(0,Math.pow(i.y/this.dollyStart.y,this.zoomSpeed));this.dolly(r.y),this.dollyStart.resetToVector(i)}if(this.enablePan){const e=.5*(t.touches[0].pageX+t.touches[1].pageX),i=.5*(t.touches[0].pageY+t.touches[1].pageY);this.handleMovePan(e,i)}}onMouseDown(e){if(this.enabled){switch(e.button){case this.mouseButtons.ORBIT:if(!1===this.enableRotate)return;this.rotateStart.reset(e.clientX,e.clientY),this.state=t.STATE_ROTATE;break;case this.mouseButtons.ZOOM:if(!1===this.enableZoom)return;this.dollyStart.reset(e.clientX,e.clientY),this.state=t.STATE_DOLLY;break;case this.mouseButtons.PAN:if(!1===this.enablePan)return;this.panStart.reset(e.clientX,e.clientY),this.state=t.STATE_PAN}this.state!==t.STATE_NONE&&(window.addEventListener("mousemove",this.onMouseMove,!1),window.addEventListener("mouseup",this.onMouseUp,!1))}}onMouseMove(e){if(this.enabled)switch(this.state){case t.STATE_ROTATE:if(!1===this.enableRotate)return;this.handleMoveRotate(e.clientX,e.clientY);break;case t.STATE_DOLLY:if(!1===this.enableZoom)return;this.handleMouseMoveDolly(e);break;case t.STATE_PAN:if(!1===this.enablePan)return;this.handleMovePan(e.clientX,e.clientY)}}onMouseUp(){window.removeEventListener("mousemove",this.onMouseMove,!1),window.removeEventListener("mouseup",this.onMouseUp,!1),this.state=t.STATE_NONE}onMouseWheel(e){!this.enabled||!this.enableZoom||this.state!==t.STATE_NONE&&this.state!==t.STATE_ROTATE||(e.stopPropagation(),e.preventDefault(),e.deltaY<0?this.dolly(1/this.getZoomScale()):e.deltaY>0&&this.dolly(this.getZoomScale()))}onTouchStart(e){if(this.enabled)switch(e.preventDefault(),e.touches.length){case 1:if(!1===this.enableRotate)return;this.rotateStart.reset(e.touches[0].pageX,e.touches[0].pageY),this.state=t.STATE_ROTATE;break;case 2:if(!1===this.enableZoom&&!1===this.enablePan)return;this.handleTouchStartDollyPan(e),this.state=t.STATE_DOLLY_PAN;break;default:this.state=t.STATE_NONE}}onTouchMove(e){if(this.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:if(!1===this.enableRotate)return;this.handleMoveRotate(e.touches[0].pageX,e.touches[0].pageY);break;case 2:if(!1===this.enableZoom&&!1===this.enablePan)return;this.handleTouchMoveDollyPan(e);break;default:this.state=t.STATE_NONE}}onTouchEnd(){this.enabled&&(this.state=t.STATE_NONE)}onContextMenu(t){this.enablePan&&this.enabled&&t.preventDefault()}addHandlers(){this.element.addEventListener("contextmenu",this.onContextMenu,!1),this.element.addEventListener("mousedown",this.onMouseDown,!1),this.element.addEventListener("wheel",this.onMouseWheel,{passive:!1}),this.element.addEventListener("touchstart",this.onTouchStart,{passive:!1}),this.element.addEventListener("touchend",this.onTouchEnd,!1),this.element.addEventListener("touchmove",this.onTouchMove,{passive:!1})}removeHandlers(){this.element.removeEventListener("contextmenu",this.onContextMenu),this.element.removeEventListener("mousedown",this.onMouseDown),this.element.removeEventListener("wheel",this.onMouseWheel),this.element.removeEventListener("touchstart",this.onTouchStart),this.element.removeEventListener("touchend",this.onTouchEnd),this.element.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseup",this.onMouseUp)}};n(F,"STATE_NONE",0),n(F,"STATE_ROTATE",1),n(F,"STATE_DOLLY",2),n(F,"STATE_PAN",4),n(F,"STATE_DOLLY_PAN",8);let R=F;class S{constructor(t,{data:e,width:i=t.canvas.width,height:s=t.canvas.height,target:r=t.FRAMEBUFFER,colour:a=1,depth:h=!0,wrapS:o=t.CLAMP_TO_EDGE,wrapT:l=t.CLAMP_TO_EDGE,minFilter:d=t.LINEAR,magFilter:u=d,type:c=t.UNSIGNED_BYTE,format:p=t.RGBA,internalFormat:m=p,unpackAlignment:g=4,premultiplyAlpha:f=!1,generateMipmaps:w=!1}={}){var b;n(this,"gl"),n(this,"buffer"),n(this,"textures"),n(this,"depthBuffer"),n(this,"stencilBuffer"),n(this,"depthStencilBuffer"),n(this,"depthTexture"),n(this,"width"),n(this,"height"),n(this,"depth"),n(this,"stencil"),n(this,"target"),this.gl=t,this.width=i,this.height=s,this.depth=h,this.buffer=this.gl.createFramebuffer(),this.target=r,this.gl.bindFramebuffer(this.target,this.buffer);const A=t.getExtension("OES_texture_half_float");(c===(null==A?void 0:A.HALF_FLOAT_OES)||c===this.gl.HALF_FLOAT)&&null!=(b=null==t?void 0:t.renderer)&&b.isWebgl2&&(m=this.gl.RGBA16F),this.textures=[];const x=[];for(let r=0;r<a;r++)this.textures.push(new E(t,{data:e,width:i,height:s,wrapS:o,wrapT:l,minFilter:d,magFilter:u,type:c,format:p,internalFormat:m,unpackAlignment:g,premultiplyAlpha:f,flipY:!1,generateMipmaps:w})),this.textures[r].update(),this.gl.framebufferTexture2D(this.target,this.gl.COLOR_ATTACHMENT0+r,this.gl.TEXTURE_2D,this.textures[r].texture,0),x.push(this.gl.COLOR_ATTACHMENT0+r);x.length>1&&this.gl.renderer.drawBuffers(x),h&&(this.gl.renderer.isWebgl2||this.gl.renderer.getExtension("WEBGL_depth_texture"))&&(this.depthTexture=new E(t,{width:i,height:s,minFilter:this.gl.NEAREST,magFilter:this.gl.NEAREST,format:this.gl.DEPTH_COMPONENT,internalFormat:t.renderer.isWebgl2?this.gl.DEPTH_COMPONENT16:this.gl.DEPTH_COMPONENT,type:this.gl.UNSIGNED_INT}),this.depthTexture.update(),this.gl.framebufferTexture2D(this.target,this.gl.DEPTH_ATTACHMENT,this.gl.TEXTURE_2D,this.depthTexture.texture,0)),this.gl.bindFramebuffer(this.target,null)}get texture(){return this.textures[0]}}const P=(t,e,i=t.STATIC_DRAW,s=t.ARRAY_BUFFER)=>{const r=t.createBuffer();return t.bindBuffer(s,r),t.bufferData(s,e,i),r};class O{constructor(t,{program:e,transformFeedbacks:i}){n(this,"VAOs"),n(this,"TFBs"),n(this,"BufferRefs"),this.VAOs=[t.createVertexArray(),t.createVertexArray()],this.TFBs=[t.createTransformFeedback(),t.createTransformFeedback()],this.BufferRefs=[];const s=Object.keys(i);this.VAOs.forEach(((r,a)=>{t.bindVertexArray(r);const n=[],h={};for(let r=0;r<s.length;r++){const a=i[s[r]],{size:o=1,type:l=t.FLOAT,normalize:d=!1,stride:u=0,offset:c=0,data:p,usage:m=t.STATIC_DRAW,buffertype:g=t.ARRAY_BUFFER,buffer:f=null}=a,w=p&&!f?P(t,p,m,g):f;h[s[r]]={i:r,buffer:w},t.bindAttribLocation(e,r,s[r]),t.enableVertexAttribArray(r),t.bindBuffer(t.ARRAY_BUFFER,w),t.vertexAttribPointer(r,o,l,d,u,c),n.push(w)}t.bindBuffer(t.ARRAY_BUFFER,null),t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,this.TFBs[a]),n.forEach(((e,i)=>{t.bindBufferBase(t.TRANSFORM_FEEDBACK_BUFFER,i,e)})),t.bindVertexArray(null),this.BufferRefs.push(h)}))}}let N=1,L=!1;const B=function(t,i=0){return new e(t[i],t[i+1],t[i+2])};class D{constructor(t,e={},i){n(this,"id"),n(this,"gl"),n(this,"attributes"),n(this,"VAOs"),n(this,"transformFeedbacks"),n(this,"transformFeedbackIndex",0),n(this,"drawRange"),n(this,"instancedCount"),n(this,"isInstanced"),n(this,"bounds"),n(this,"glState"),t.canvas||console.error("gl not passed as first argument to Geometry"),this.gl=t,this.attributes=e,this.id=N++,this.VAOs={},i&&(this.transformFeedbacks=i),this.gl.renderer.bindVertexArray(null),this.drawRange={start:0,count:0},this.instancedCount=0;for(const t in e)this.addAttribute(t,e[t])}addAttribute(t,e){if(this.attributes[t]=e,e.target="index"===t?this.gl.ELEMENT_ARRAY_BUFFER:this.gl.ARRAY_BUFFER,e.count=e.count||(e.stride?e.data.byteLength/e.stride:e.data.length/e.size),e.needsUpdate=!1,e.buffer||(e.buffer=this.gl.createBuffer(),e.updateAttribute(this.gl)),e.divisor){if(this.isInstanced=!0,this.instancedCount&&this.instancedCount!==e.count*e.divisor)return console.warn("geometry has multiple instanced buffers of different length"),void(this.instancedCount=Math.min(this.instancedCount,e.count*e.divisor));this.instancedCount=e.count*e.divisor}else"index"===t?this.drawRange.count=e.count:this.attributes.index||(this.drawRange.count=Math.max(this.drawRange.count,e.count))}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}setInstancedCount(t){this.instancedCount=t}createVAO(t){this.VAOs[t.attributeOrder]=this.gl.renderer.createVertexArray(),this.gl.renderer.bindVertexArray(this.VAOs[t.attributeOrder]),this.bindAttributes(t)}bindAttributes(t){t.attributeLocations.forEach(((t,{name:e,type:i})=>{if(!this.attributes[e])return void console.warn(`active attribute ${e} not being supplied`);const s=this.attributes[e];this.gl.bindBuffer(s.target,s.buffer),this.gl.renderer.state.boundBuffer=s.buffer;let r=1;35674===i&&(r=2),35675===i&&(r=3),35676===i&&(r=4);const a=s.size/r,n=1===r?0:r*r*4,h=1===r?0:4*r;for(let e=0;e<r;e++)this.gl.vertexAttribPointer(t+e,a,s.type,s.normalized,s.stride+n,s.offset+e*h),this.gl.enableVertexAttribArray(t+e),this.gl.renderer.vertexAttribDivisor(t+e,s.divisor)})),this.attributes.index&&this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.attributes.index.buffer)}bindTransformFeedbacks(){const t=(this.transformFeedbackIndex+1)%2,e=this.transformFeedbacks.VAOs[this.transformFeedbackIndex],i=this.transformFeedbacks.TFBs[t],s=this.transformFeedbacks.BufferRefs[t];this.gl.bindVertexArray(e),this.gl.bindTransformFeedback(this.gl.TRANSFORM_FEEDBACK,i),window.feedbk=i;for(const t in s){const e=s[t];this.gl.bindBufferBase(this.gl.TRANSFORM_FEEDBACK_BUFFER,e.i,e.buffer)}this.transformFeedbackIndex=t}draw({program:t,mode:e=this.gl.TRIANGLES}){this.gl.renderer.currentGeometry!==`${this.id}_${t.attributeOrder}`&&(this.VAOs[t.attributeOrder]||this.createVAO(t),this.gl.renderer.bindVertexArray(this.VAOs[t.attributeOrder]),this.gl.renderer.currentGeometry=`${this.id}_${t.attributeOrder}`),window.transformFeedbacks=this.transformFeedbacks,this.transformFeedbacks&&(this.bindTransformFeedbacks(),this.gl.beginTransformFeedback(e)),null==t||t.attributeLocations.forEach(((t,{name:e})=>{const i=this.attributes[e];i&&i.needsUpdate&&i.updateAttribute(this.gl)})),this.isInstanced?this.attributes.index?this.gl.renderer.drawElementsInstanced(e,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+2*this.drawRange.start,this.instancedCount):this.gl.renderer.drawArraysInstanced(e,this.drawRange.start,this.drawRange.count,this.instancedCount):this.attributes.index?this.gl.drawElements(e,this.drawRange.count,this.attributes.index.type,this.attributes.index.offset+2*this.drawRange.start):this.gl.drawArrays(e,this.drawRange.start,this.drawRange.count),this.transformFeedbacks&&this.gl.endTransformFeedback()}getPosition(){const t=this.attributes.position;if(t.data)return t;L||(L=!0,console.warn("No position buffer data found to compute bounds"))}computeBoundingBox(t){t||(t=this.getPosition());const i=t.data,s=t.offset||0,r=t.stride||t.size;this.bounds||(this.bounds={min:new e,max:new e,center:new e,scale:new e,radius:1/0});const a=this.bounds.min,n=this.bounds.max,h=this.bounds.center,o=this.bounds.scale;a.reset(1/0,1/0,1/0),n.reset(-1/0,-1/0,-1/0);for(let t=s,e=i.length;t<e;t+=r){const e=i[t],s=i[t+1],r=i[t+2];a.x=Math.min(e,a.x),a.y=Math.min(s,a.y),a.z=Math.min(r,a.z),n.x=Math.max(e,n.x),n.y=Math.max(s,n.y),n.z=Math.max(r,n.z)}o.resetToVector(n.subtractNew(a)),h.resetToVector(a.addNew(n).scale(.5))}computeBoundingSphere(t){t||(t=this.getPosition());const e=t.data,i=t.offset||0,s=t.stride||t.size;this.bounds||this.computeBoundingBox(t);let r=0;for(let t=i,a=e.length;t<a;t+=s){const i=B(e,t);r=Math.max(r,this.bounds.center.subtractNew(i).lengthSquared)}this.bounds.radius=Math.sqrt(r)}remove(){for(const t in this.VAOs)this.gl.renderer.deleteVertexArray(this.VAOs[t]),delete this.VAOs[t];for(const t in this.attributes)this.gl.deleteBuffer(this.attributes[t].buffer),delete this.attributes[t]}}class C{constructor({size:t=1,stride:e=0,offset:i=0,instanced:s=0,count:r,type:a,normalized:h=!1,data:o}){n(this,"size",1),n(this,"stride",0),n(this,"offset",0),n(this,"count"),n(this,"divisor",0),n(this,"instanced"),n(this,"data"),n(this,"buffer"),n(this,"type"),n(this,"target"),n(this,"normalized"),n(this,"needsUpdate",!1),this.size=t,this.stride=e,this.offset=i,this.instanced=s,this.data=o,this.type=a||(this.data.constructor===Float32Array?window.WebGLRenderingContext.FLOAT:this.data.constructor===Uint16Array?window.WebGLRenderingContext.UNSIGNED_SHORT:window.WebGLRenderingContext.UNSIGNED_INT),this.normalized=h,this.count=r||e?o.byteLength/e:o.length/t,this.divisor=s||0}updateAttribute(t){t.renderer.state.boundBuffer!==this.buffer&&(t.bindBuffer(this.target,this.buffer),t.renderer.state.boundBuffer=this.buffer),t.bufferData(this.target,this.data,t.STATIC_DRAW),this.needsUpdate=!1}}class I extends D{constructor(t,{attributes:e={}}={}){Object.assign(e,{position:new C({size:2,data:new Float32Array([-1,-1,3,-1,-1,3])}),uv:new C({size:2,data:new Float32Array([0,0,2,0,0,2])})}),super(t,e)}}class U extends D{constructor(t,{width:e=1,height:i=1,widthSegments:s=1,heightSegments:r=1,attributes:a={}}={}){const n=s,h=r,o=(n+1)*(h+1),l=n*h*6,d=new Float32Array(3*o),u=new Float32Array(3*o),c=new Float32Array(2*o),p=l>65536?new Uint32Array(l):new Uint16Array(l);U.buildPlane(d,u,c,p,e,i,0,n,h);super(t,Object.assign({},a,{position:new C({size:3,data:d}),normal:new C({size:3,data:u}),uv:new C({size:2,data:c}),index:new C({data:p})}))}static buildPlane(t,e,i,s,r,a,n,h,o,l=0,d=1,u=2,c=1,p=-1,m=0,g=0){const f=m,w=r/h,b=a/o;for(let E=0;E<=o;E++){const A=E*b-a/2;for(let a=0;a<=h;a++,m++){const b=a*w-r/2;if(t[3*m+l]=b*c,t[3*m+d]=A*p,t[3*m+u]=n/2,e[3*m+l]=0,e[3*m+d]=0,e[3*m+u]=n>=0?1:-1,i[2*m]=a/h,i[2*m+1]=1-E/o,E===o||a===h)continue;const x=f+a+E*(h+1),v=f+a+(E+1)*(h+1),T=f+a+(E+1)*(h+1)+1,_=f+a+E*(h+1)+1;s[6*g]=x,s[6*g+1]=v,s[6*g+2]=_,s[6*g+3]=v,s[6*g+4]=T,s[6*g+5]=_,g++}}}}class k extends D{constructor(t,{width:e=1,height:i=1,depth:s=1,widthSegments:r=1,heightSegments:a=1,depthSegments:n=1,attributes:h={}}={}){const o=r,l=a,d=n,u=(o+1)*(l+1)*2+(o+1)*(d+1)*2+(l+1)*(d+1)*2,c=6*(o*l*2+o*d*2+l*d*2),p=new Float32Array(3*u),m=new Float32Array(3*u),g=new Float32Array(2*u),f=u>65536?new Uint32Array(c):new Uint16Array(c);let w=0,b=0;U.buildPlane(p,m,g,f,s,i,e,d,l,2,1,0,-1,-1,w,b),w+=(d+1)*(l+1),b+=d*l,U.buildPlane(p,m,g,f,s,i,-e,d,l,2,1,0,1,-1,w,b),w+=(d+1)*(l+1),b+=d*l,U.buildPlane(p,m,g,f,e,s,i,d,o,0,2,1,1,1,w,b),w+=(o+1)*(d+1),b+=o*d,U.buildPlane(p,m,g,f,e,s,-i,d,o,0,2,1,1,-1,w,b),w+=(o+1)*(d+1),b+=o*d,U.buildPlane(p,m,g,f,e,i,-s,o,l,0,1,2,-1,-1,w,b),w+=(o+1)*(l+1),b+=o*l,U.buildPlane(p,m,g,f,e,i,s,o,l,0,1,2,1,-1,w,b);super(t,Object.assign({},h,{position:new C({size:3,data:p}),normal:new C({size:3,data:m}),uv:new C({size:2,data:g}),index:new C({data:f})}))}}class z extends D{constructor(t,{particles:e=128,dimensions:i=3,fillFunction:s=((t,e)=>{for(let i=0;i<t.length;i+=e)for(let s=0;s<e;s++)t[i+s]=Math.random()}),attributes:r={},transformFeedbacks:a}={}){const n=new Float32Array(e*i).fill(0);s(n,i);super(t,Object.assign({},r,{position:new C({size:i,data:n})}),a)}}var G,Y,V,W,X,j,H,q;const Z=class t{constructor(e,{name:i="FBO",width:s=512,height:r=512,dpr:a=Math.min(window.devicePixelRatio,2),tiling:h=t.IMAGETYPE_REGULAR,texdepth:o=t.TEXTYPE_UNSIGNED_BYTE,minFilter:d=e.LINEAR,magFilter:u=d,premultiplyAlpha:c=!1,data:p=null,depth:m=!0,generateMipmaps:g=!1}={}){n(this,"gl"),n(this,"name"),n(this,"depth"),l(this,G,void 0),l(this,Y,void 0),l(this,V,void 0),l(this,W,void 0),l(this,X,void 0),l(this,j,t.IMAGETYPE_REGULAR),l(this,H,t.TEXTYPE_UNSIGNED_BYTE),l(this,q,void 0),n(this,"minFilter"),n(this,"magFilter"),n(this,"premultiplyAlpha"),n(this,"generateMipmaps"),this.gl=e,this.name=i,this.dpr=a,this.tiling=h,this.texdepth=o,this.data=p,this.depth=m,this.minFilter=d,this.magFilter=u,this.premultiplyAlpha=c,this.generateMipmaps=g,this.resize(s,r)}resize(t,e){this.width=t,this.height=e,d(this,G,this.createFrameBuffer()),d(this,Y,this.createFrameBuffer())}createFrameBuffer(){const t=this.type===this.gl.FLOAT?this.gl.RGBA32F:this.gl.RGBA;return new S(this.gl,{data:this.data,width:this.width*this.dpr,height:this.height*this.dpr,minFilter:this.minFilter,magFilter:this.magFilter,wrapS:this.wrap,wrapT:this.wrap,type:this.type,internalFormat:t,premultiplyAlpha:this.premultiplyAlpha,depth:this.depth,generateMipmaps:this.generateMipmaps})}swap(){const t=o(this,G);d(this,G,o(this,Y)),d(this,Y,t)}render(t,{scene:e,camera:i,update:s=!0,clear:r,viewport:a}){t.render({scene:e,camera:i,target:o(this,Y),update:s,clear:r,viewport:a}),this.generateMipmaps&&this.gl.generateMipmap(this.gl.TEXTURE_2D),this.swap()}get wrap(){switch(o(this,j)){case t.IMAGETYPE_REGULAR:return this.gl.CLAMP_TO_EDGE;case t.IMAGETYPE_TILING:return this.gl.MIRRORED_REPEAT;case t.IMAGETYPE_MIRROR:return this.gl.REPEAT}}get type(){switch(o(this,H)){case t.TEXTYPE_FLOAT:return this.gl.FLOAT;case t.TEXTYPE_UNSIGNED_BYTE:return this.gl.UNSIGNED_BYTE;case t.TEXTYPE_HALF_FLOAT_OES:{const t=this.gl.getExtension("OES_texture_half_float");return(null==t?void 0:t.HALF_FLOAT_OES)||this.gl.HALF_FLOAT}}}get read(){return o(this,G)}get write(){return o(this,Y)}set data(t){t instanceof Float32Array&&d(this,q,t)}get data(){return o(this,q)||null}set width(t){t>0&&d(this,V,t)}get width(){return o(this,V)||1}set height(t){t>0&&d(this,W,t)}get height(){return o(this,W)||1}set pxRatio(t){t>0&&d(this,X,t)}get pxRatio(){return o(this,X)||1}set dpr(t){t>0&&d(this,X,t)}get dpr(){return o(this,X)||1}set tiling(e){[t.IMAGETYPE_REGULAR,t.IMAGETYPE_TILING,t.IMAGETYPE_MIRROR].indexOf(e)>-1&&d(this,j,e)}get tiling(){return o(this,j)}set texdepth(e){[t.TEXTYPE_FLOAT,t.TEXTYPE_UNSIGNED_BYTE,t.TEXTYPE_HALF_FLOAT_OES].indexOf(e)>-1&&d(this,H,e)}get texdepth(){return o(this,H)}};G=new WeakMap,Y=new WeakMap,V=new WeakMap,W=new WeakMap,X=new WeakMap,j=new WeakMap,H=new WeakMap,q=new WeakMap,n(Z,"TEXTYPE_FLOAT",0),n(Z,"TEXTYPE_UNSIGNED_BYTE",1),n(Z,"TEXTYPE_HALF_FLOAT_OES",2),n(Z,"IMAGETYPE_REGULAR",0),n(Z,"IMAGETYPE_TILING",1),n(Z,"IMAGETYPE_MIRROR",2);let $=Z;const K=typeof window<"u";var Q,J;class tt{constructor({vertex:t="attribute vec3 position;\nattribute vec2 uv;\n\nvarying vec2 v_uv;\n\nvoid main() {\n  gl_Position = vec4(position, 1.0);\n  v_uv = uv;\n}",fragment:e="precision highp float;\n\nuniform vec2 u_resolution;\nuniform float u_time;\nuniform vec2 u_mouse;\nuniform sampler2D s_noise;\n\nuniform sampler2D b_noise;\n\nvarying vec2 v_uv;\n\nvoid main() {\n  gl_FragColor = vec4(vec3(cos(length(v_uv+u_time))*.5+.5, sin(v_uv+u_time)*.5+.5),1);\n}",dimensions:i=(K?new s(window.innerWidth,window.innerHeight):new s(500,500)),container:r=document.body,autoResize:a=!0,uniforms:h={},onInit:o=(()=>{}),onBeforeRender:d=(()=>{}),onAfterRender:u=(()=>{}),rendererProps:c={}}={}){n(this,"uniforms"),n(this,"dimensions"),n(this,"autoResize",!0),n(this,"onBeforeRender"),n(this,"onAfterRender"),n(this,"u_time"),n(this,"u_resolution"),n(this,"gl"),n(this,"renderer"),n(this,"program"),n(this,"mesh"),n(this,"lastTime",0),l(this,Q,void 0),l(this,J,!1),this.onBeforeRender=d.bind(this),this.onAfterRender=u.bind(this),this.render=this.render.bind(this),this.resize=this.resize.bind(this),this.autoResize=a,this.dimensions=i,this.u_time=new A({name:"time",value:0,kind:"float"}),this.u_resolution=new A({name:"resolution",value:this.dimensions.array,kind:"float_vec2"}),this.uniforms=Object.assign({},h,{u_time:this.u_time,u_resolution:this.u_resolution}),this.renderer=new g(c),o(this.renderer),this.gl=this.renderer.gl,r.appendChild(this.gl.canvas),this.gl.clearColor(1,1,1,1),this.autoResize&&K?(window.addEventListener("resize",this.resize,!1),this.resize()):(this.renderer.dimensions=i,this.u_resolution.value=this.dimensions.scaleNew(this.renderer.dpr).array);const p=new I(this.gl);this.program=new T(this.gl,{vertex:t,fragment:e,uniforms:this.uniforms}),this.mesh=new x(this.gl,{geometry:p,program:this.program}),this.playing=!0}resize(){this.dimensions=K?new s(window.innerWidth,window.innerHeight):new s(500,500),this.u_resolution.value=this.dimensions.scaleNew(this.renderer.dpr).array,this.renderer.dimensions=this.dimensions}resetTime(){this.lastTime=0}render(t){const e=t-this.lastTime;this.lastTime=t,this.playing&&requestAnimationFrame(this.render);const i=this.u_time.value;this.u_time.value=i+5e-5*e,this.onBeforeRender(t),this.post?this.post.render(this.renderer,{scene:this.mesh}):this.renderer.render({scene:this.mesh}),this.onAfterRender(t)}set post(t){d(this,Q,t)}get post(){return o(this,Q)||null}set playing(t){!0!==o(this,J)&&!0===t?(requestAnimationFrame(this.render),d(this,J,!0)):0==t&&(this.lastTime=0,d(this,J,!1))}get playing(){return!0===o(this,J)}}Q=new WeakMap,J=new WeakMap;const et=typeof window<"u";var it,st,rt,at,nt,ht,ot,lt;class dt{constructor({vertex:t="attribute vec2 reference;\nattribute vec2 position;\nattribute float property;\n\nuniform vec2 u_resolution;\nuniform vec2 u_screen;\n\nuniform sampler2D b_velocity;\nuniform sampler2D b_position;\n\nvarying vec3 v_colour;\nvarying float v_fogDepth;\n\nvoid main() {\n  vec2 position = texture2D(b_position, reference).xy;\n  gl_PointSize = 2.;\n  vec2 p = position/u_resolution;\n  v_colour = property == 1. ? vec3(1,0,0) : vec3(1,1,1);\n  vec4 pos = vec4(position / u_resolution * 2. - 1., 0., 1.);\n  gl_Position = vec4(pos.xy, 0., 1.);\n}",fragment:e="#extension GL_OES_standard_derivatives : enable\nprecision highp float;\n\nuniform vec2 u_resolution;\nuniform vec2 u_mouse;\nuniform float u_time;\n\nvarying vec3 v_colour;\n\nvoid main() {\n  vec2 uv = gl_PointCoord.xy - .5;\n\n  gl_FragColor = vec4(0, 0, 0, 1);\n\n  float l = length(uv);\n  float c = smoothstep(.5, 0., l);\n  float opacity = c;\n\n  gl_FragColor = vec4(v_colour, 1.);\n}",dimensions:i=(et?new s(window.innerWidth,window.innerHeight):new s(500,500)),container:r=document.body,autoResize:a=!0,uniforms:h={},onBeforeRender:o=(()=>{}),onAfterRender:d=(()=>{}),textureSize:u=128,simDimensions:c=3,createGeometry:p,rendererProps:m={}}={}){n(this,"uniforms"),n(this,"dimensions"),n(this,"autoResize",!0),n(this,"onBeforeRender"),n(this,"onAfterRender"),n(this,"u_time"),n(this,"u_resolution"),n(this,"gl"),n(this,"renderer"),n(this,"program"),n(this,"mesh"),n(this,"textureSize"),n(this,"particles"),n(this,"textureArraySize"),n(this,"simDimensions"),n(this,"references"),n(this,"cloud"),n(this,"lastTime",0),l(this,it,void 0),l(this,st,!1),l(this,rt,void 0),l(this,at,!0),l(this,nt,!0),l(this,ht,!0),l(this,ot,void 0),l(this,lt,void 0),this.onBeforeRender=o.bind(this),this.onAfterRender=d.bind(this),this.render=this.render.bind(this),this.resize=this.resize.bind(this),this.autoResize=a,this.dimensions=i,this.u_time=new A({name:"time",value:0,kind:"float"}),this.u_resolution=new A({name:"resolution",value:this.dimensions.array,kind:"float_vec2"}),this.uniforms=Object.assign({},h,{u_time:this.u_time,u_resolution:this.u_resolution}),this.renderer=new g(m),this.gl=this.renderer.gl,this.gl.clearColor(0,0,0,1),this.autoResize&&et?(window.addEventListener("resize",this.resize,!1),this.resize()):this.renderer.dimensions=i,this.textureSize=u,this.particles=Math.pow(this.textureSize,2),this.textureArraySize=4*this.particles,this.simDimensions=c,this.references=new Float32Array(2*this.particles).fill(0),p&&"function"==typeof p?p.bind(this)():this.createGeometry(),this.program=new T(this.gl,{vertex:t,fragment:e,uniforms:this.uniforms}),this.mesh=new x(this.gl,{mode:this.gl.POINTS,geometry:this.cloud,program:this.program}),this.playing=!0,r.appendChild(this.gl.canvas)}createGeometry(){this.cloud=new z(this.gl,{fillFunction:(t,e)=>{for(let e=0;e<t.length;e+=2){const t=e/2,i=new s(t%this.textureSize,Math.floor(t/this.textureSize));this.references[e]=i.x/this.textureSize,this.references[e+1]=i.y/this.textureSize}for(let i=0;i<t.length;i+=e)for(let s=0;s<e;s++)t[i+s]=400*Math.random()-200},particles:this.particles,dimensions:this.simDimensions,attributes:{reference:new C({size:2,data:this.references})}})}render(t){const e=t-this.lastTime;this.lastTime=t,this.playing&&requestAnimationFrame(this.render);const i=this.u_time.value;this.u_time.value=i+5e-5*e,this.onBeforeRender(t),this.post?this.post.render(this.renderer,{scene:this.mesh,camera:this.camera,update:this.update,sort:this.sort,frustumCull:this.frustumCull,clear:this.clear,viewport:this.viewport}):this.renderer.render({scene:this.mesh,camera:this.camera,update:this.update,sort:this.sort,frustumCull:this.frustumCull,clear:this.clear,viewport:this.viewport}),this.onAfterRender(t)}resize(){this.dimensions=et?new s(window.innerWidth,window.innerHeight):new s(500,500),this.u_resolution.value=this.dimensions.scaleNew(this.renderer.dpr).array,this.renderer.dimensions=this.dimensions}set post(t){d(this,it,t)}get post(){return o(this,it)||null}set playing(t){!0!==o(this,st)&&!0===t?(requestAnimationFrame(this.render),d(this,st,!0)):0==t&&d(this,st,!1)}get playing(){return!0===o(this,st)}set camera(t){(null==t||t instanceof y)&&d(this,rt,t)}get camera(){return o(this,rt)}set update(t){d(this,at,!0===t)}get update(){return o(this,at)}set sort(t){d(this,nt,!0===t)}get sort(){return o(this,nt)}set frustumCull(t){d(this,ht,!0===t)}get frustumCull(){return o(this,ht)}set clear(t){d(this,ot,!0===t)}get clear(){return o(this,ot)}set viewport(t){(t instanceof Array&&t[0]instanceof s&&t[1]instanceof s||null==t)&&d(this,lt,t)}get viewport(){return o(this,lt)}}it=new WeakMap,st=new WeakMap,rt=new WeakMap,at=new WeakMap,nt=new WeakMap,ht=new WeakMap,ot=new WeakMap,lt=new WeakMap;export{k as Box,y as Camera,R as DollyCamera,p as Drawable,tt as FragmentShader,$ as Framebuffer,D as Geometry,C as GeometryAttribute,x as Mesh,u as Obj,dt as ParticleSimulation,U as Plane,z as PointCloud,T as Program,S as RenderTarget,g as Renderer,E as Texture,O as TransformFeedback,I as Triangle,A as Uniform};export default null;
//# sourceMappingURL=/sm/d92a9398b1604ec9472ca3250f30c4b1321735f9eed8ddb28e4d6eab5e528109.map